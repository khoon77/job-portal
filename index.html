<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- SEO 최적화 메타태그 -->
    <title>대한민국 공공기관 채용정보 | 고용·채용·일자리·일터·채용정보 취업포털</title>
    <meta name="description" content="대한민국 정부기관, 공공기관, 지자체의 최신 채용정보와 일자리 정보를 실시간으로! 고용, 채용, 일터, 채용정보 관련 모든 정보를 제공하는 대한민국 최대 공공일자리 취업포털. 공무원 채용공고, 정규직·계약직·무기계약직 채용정보를 한눈에 확인하세요.">
    <meta name="keywords" content="고용, 채용, 일자리, 일터, 채용정보, 공공기관 채용, 정부기관 채용, 지자체 채용, 공무원 채용, 채용공고, 취업정보, 구인구직, 공공일자리, 정규직 채용, 계약직 채용, 무기계약직 채용, 임시직 채용, 채용공고 모음, 최신 채용정보, 취업 포털, 구직 정보, 공공부문 채용, 국가기관 채용, 지방자치단체 채용">
    <meta name="author" content="대한민국 공공기관 채용정보 포털">
    <meta name="robots" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1">
    <meta name="language" content="Korean">
    <meta name="geo.region" content="KR">
    <meta name="geo.country" content="Korea">
    
    <!-- Open Graph 메타태그 (소셜미디어 공유용) -->
    <meta property="og:title" content="대한민국 공공기관 채용정보 | 고용·채용·일자리·일터·채용정보">
    <meta property="og:description" content="정부기관, 공공기관, 지자체의 최신 채용정보와 일자리 정보를 실시간으로 확인하세요. 공무원 채용공고부터 공공기관 정규직·계약직 채용정보까지 모든 채용정보를 한곳에서!">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://job-portal-v1-6-nextjs.vercel.app/portal.html">
    <meta property="og:site_name" content="대한민국 공공기관 채용정보">
    <meta property="og:locale" content="ko_KR">
    <meta property="og:image" content="https://job-portal-v1-6-nextjs.vercel.app/og-image.jpg">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:image:alt" content="대한민국 공공기관 채용정보 포털">
    
    <!-- Twitter Card 메타태그 -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="대한민국 공공기관 채용정보 | 고용·채용·일자리·일터·채용정보">
    <meta name="twitter:description" content="정부기관, 공공기관, 지자체의 최신 채용정보와 일자리 정보를 실시간으로 확인하세요">
    <meta name="twitter:image" content="https://job-portal-v1-6-nextjs.vercel.app/twitter-card.jpg">
    
    <!-- Canonical URL -->
    <link rel="canonical" href="https://job-portal-v1-6-nextjs.vercel.app/portal.html">


    <!-- PWA 설정 -->
    <link rel="manifest" href="./manifest.json">
    <meta name="apple-mobile-web-app-title" content="정부 채용">
    <link rel="apple-touch-icon" href="./icon-192.png">
    <link rel="icon" type="image/png" sizes="192x192" href="./icon-192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="./icon-512.png">
    
    <!-- 최신 웹폰트 -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@100;200;300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/variable/pretendardvariable.min.css" rel="stylesheet">
    
    <!-- 추가 SEO 메타태그 -->
    <meta name="theme-color" content="#1565c0">
    <meta name="msapplication-TileColor" content="#1565c0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="format-detection" content="telephone=no">
    
    <!-- 구조화된 데이터 (Schema.org) -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebSite",
        "name": "대한민국 공공기관 채용정보",
        "description": "고용, 채용, 일자리, 일터, 채용정보 관련 공공기관 채용정보 포털",
        "url": "https://job-portal-v1-6-nextjs.vercel.app/portal.html",
        "publisher": {
            "@type": "Organization",
            "name": "대한민국 공공기관 채용정보 포털"
        },
        "potentialAction": {
            "@type": "SearchAction",
            "target": "https://job-portal-v1-6-nextjs.vercel.app/portal.html?search={search_term_string}",
            "query-input": "required name=search_term_string"
        },
        "mainEntity": {
            "@type": "JobPosting",
            "description": "대한민국 정부기관, 공공기관, 지자체 채용정보",
            "datePosted": "2025-09-05",
            "validThrough": "2025-12-31",
            "employmentType": ["FULL_TIME", "PART_TIME", "CONTRACT", "TEMPORARY"],
            "hiringOrganization": {
                "@type": "Organization",
                "name": "대한민국 공공기관",
                "sameAs": "https://job-portal-v1-6-nextjs.vercel.app/portal.html"
            },
            "jobLocation": {
                "@type": "Place",
                "addressCountry": "KR",
                "addressRegion": "전국"
            }
        }
    }
    </script>
    
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' 'unsafe-eval' data: https: http://localhost:3001; script-src 'self' 'unsafe-inline' 'unsafe-eval' https: http://localhost:3001 *.google.com *.googletagmanager.com *.googlesyndication.com *.doubleclick.net; style-src 'self' 'unsafe-inline' https:; font-src 'self' data: https:; connect-src 'self' https: http://localhost:3001; img-src 'self' data: https: *.google.com *.googleusercontent.com; frame-src 'self' http://localhost:3001;">
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore-compat.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Pretendard Variable', 'Pretendard', 'Noto Sans KR', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #f5f6fa 0%, #e8eaf0 100%);
            color: #2c3e50;
            line-height: 1.6;
        }

        /* 헤더 */
        .header {
            background: #ffffff;
            color: #1565c0;
            padding: 30px 0 40px 0;
            text-align: center;
            border-bottom: 1px solid #e0e0e0;
            margin-bottom: 40px;
        }
        
        

        .header-content {
            display: flex;
            align-items: center;
            justify-content: center;
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
            position: relative;
            z-index: 1;
        }

        .header-icon {
            font-size: 32px;
            line-height: 1;
            filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.2));
            margin-right: 8px;
            vertical-align: middle;
            display: inline-block;
        }

        .header-text {
            text-align: left;
        }

        .header h1 {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 8px;
            letter-spacing: -0.5px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .title-highlight {
            color: #1e40af;
            font-weight: 800;
            text-shadow: 2px 2px 4px rgba(30, 64, 175, 0.2);
        }
        
        .title-special {
            color: #2563eb;
            font-weight: 800;
            text-shadow: 2px 2px 4px rgba(37, 99, 235, 0.2);
        }

        .header p {
            font-size: 18px;
            opacity: 0.9;
            font-weight: 300;
            margin: 0;
        }

        /* 컨테이너 */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* 제어 패널 */
        .controls {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 15px rgba(0,0,0,0.08);
            margin-bottom: 30px;
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        .search-box {
            flex: 1;
            min-width: 250px;
        }

        .search-box input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e1e8ed;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .search-box input:focus {
            outline: none;
            border-color: #3742fa;
            box-shadow: 0 0 0 3px rgba(55, 66, 250, 0.1);
        }

        .load-btn {
            padding: 12px 24px;
            background: #2ed573;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .load-btn:hover {
            background: #26d065;
            transform: translateY(-1px);
        }

        .load-btn:disabled {
            background: #95a5a6;
            cursor: not-allowed;
            transform: none;
        }

        /* 통계 카드 */
        .stats-grid {
            background: #1976d2;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            display: flex;
            justify-content: space-around;
            align-items: center;
            color: white;
        }

        .stat-card {
            text-align: center;
            flex: 1;
        }

        .stat-number {
            font-size: 32px;
            font-weight: 700;
            color: white;
            margin-bottom: 8px;
        }

        .stat-label {
            font-size: 14px;
            color: white;
            font-weight: 500;
        }

        .stat-sublabel {
            font-size: 11px;
            color: #fbbf24;
            margin-top: 2px;
            font-weight: 400;
        }

        .stat-number.clickable {
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .stat-number.clickable:hover {
            transform: scale(1.1);
            text-shadow: 0 0 20px rgba(255, 255, 255, 0.8);
        }

        .urgent-stat .stat-number {
            color: #ff4444;
            font-weight: 800;
        }

        /* 채용공고 리스트 */
        .jobs-section {
            background: transparent;
        }

        .jobs-container {
            padding: 0;
        }

        .jobs-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .job-card {
            background: linear-gradient(145deg, #ffffff 0%, #f8fafc 100%);
            border: none;
            border-radius: 20px;
            padding: 28px;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            position: relative;
            box-shadow: 
                0 4px 20px rgba(0, 0, 0, 0.08),
                0 1px 3px rgba(0, 0, 0, 0.05),
                inset 0 1px 0 rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            overflow: hidden;
        }
        
        .job-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #667eea, #764ba2, #f093fb);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .job-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 
                0 15px 40px rgba(0, 0, 0, 0.12),
                0 5px 15px rgba(102, 126, 234, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.9);
        }
        
        .job-card:hover::before {
            opacity: 1;
        }
        
        .job-card:active {
            transform: translateY(-4px) scale(1.01);
        }

        .job-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 16px;
            position: relative;
        }

        .job-badges {
            display: flex;
            gap: 8px;
            margin-bottom: 12px;
            flex-wrap: wrap;
        }

        .job-dday-badge {
            position: absolute;
            top: 0;
            right: 0;
            padding: 6px 12px;
            border-radius: 16px;
            font-size: 12px;
            font-weight: 600;
            border: 2px solid;
            background: white;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .job-dday-badge.today {
            background: transparent;
            color: #dc2626;
            border: 2px solid #dc2626;
            box-shadow: 0 2px 8px rgba(220, 38, 38, 0.2);
            animation: urgentPulse 2s ease-in-out infinite;
        }

        .job-dday-badge.urgent {
            background: transparent;
            color: #dc2626;
            border: 2px solid #dc2626;
            box-shadow: 0 2px 8px rgba(220, 38, 38, 0.2);
            animation: urgentPulse 2s ease-in-out infinite;
        }
        
        @keyframes urgentPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .job-dday-badge.normal {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
            border: none;
            box-shadow: 0 4px 15px rgba(245, 158, 11, 0.3);
        }

        .job-dday-badge.expired {
            background: linear-gradient(135deg, #9ca3af, #6b7280);
            color: white;
            border: none;
            box-shadow: 0 4px 15px rgba(107, 114, 128, 0.2);
        }

        .job-dday-badge.permanent {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            border: none;
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
            animation: permanentGlow 3s ease-in-out infinite;
        }

        @keyframes permanentGlow {
            0%, 100% { box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3); }
            50% { box-shadow: 0 4px 20px rgba(16, 185, 129, 0.5); }
        }

        .job-badge {
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }
        
        .job-badge:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .badge-new {
            background: linear-gradient(135deg, #fbbf24, #f59e0b);
            color: white;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
        }

        /* 기관별 색상 구분 */
        .badge-org {
            padding: 4px 12px;
            border-radius: 8px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .badge-org.org-1 { background: #dbeafe; color: #1e40af; }
        .badge-org.org-2 { background: #dcfce7; color: #166534; }
        .badge-org.org-3 { background: #fef3c7; color: #92400e; }
        .badge-org.org-4 { background: #fce7f3; color: #be185d; }
        .badge-org.org-5 { background: #f3e8ff; color: #7c2d12; }
        .badge-org.org-6 { background: #ecfdf5; color: #047857; }
        .badge-org.org-7 { background: #fff7ed; color: #c2410c; }
        .badge-org.org-8 { background: #f0f9ff; color: #0369a1; }
        .badge-org.org-9 { background: #fdf4ff; color: #a21caf; }
        .badge-org.org-10 { background: #f1f5f9; color: #475569; }

        .badge-intern {
            background: #e0e7ff;
            color: #3730a3;
        }


        .job-title {
            font-size: 19px;
            font-weight: 700;
            background: linear-gradient(135deg, #1f2937, #374151);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            line-height: 1.4;
            margin-bottom: 18px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        
        .job-card:hover .job-title {
            transform: translateX(2px);
        }

        .job-meta {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 20px;
            font-size: 14px;
            color: #6b7280;
        }

        .meta-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .meta-icon {
            font-size: 16px;
            width: 16px;
            flex-shrink: 0;
        }

        .job-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 16px;
            border-top: 1px solid #f3f4f6;
        }

        .job-dates {
            font-size: 13px;
            color: #9ca3af;
        }

        .job-actions {
            display: flex;
            gap: 8px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 25px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
        }
        
        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.6s;
        }
        
        .btn:hover::before {
            left: 100%;
        }

        .btn-detail {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .btn-detail:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
            background: linear-gradient(135deg, #764ba2, #667eea);
        }


        /* 로딩 상태 */
        .loading {
            text-align: center;
            padding: 60px 20px;
            color: #7f8c8d;
        }

        .loading-spinner {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3742fa;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* 모달 */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(0,0,0,0.6), rgba(26, 41, 128, 0.3));
            backdrop-filter: blur(10px);
            animation: modalFadeIn 0.3s ease-out;
        }
        
        @keyframes modalFadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background: linear-gradient(145deg, #ffffff 0%, #f8fafc 100%);
            margin: 2% auto;
            border-radius: 24px;
            width: 95%;
            max-width: 1000px;
            max-height: 95vh;
            overflow: hidden;
            box-shadow: 
                0 25px 80px rgba(0, 0, 0, 0.3),
                0 10px 25px rgba(102, 126, 234, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.9);
            animation: modalSlideIn 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(20px);
        }
        
        @keyframes modalSlideIn {
            from { 
                transform: translateY(-50px) scale(0.95); 
                opacity: 0; 
            }
            to { 
                transform: translateY(0) scale(1); 
                opacity: 1; 
            }
        }
        
        .modal-content-wrapper {
            max-height: 95vh;
            overflow-y: auto;
        }

        .modal-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px 35px;
            border-bottom: none;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
            overflow: hidden;
        }
        
        .modal-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at 20% 30%, rgba(255, 255, 255, 0.2) 0%, transparent 50%);
            pointer-events: none;
        }

        .modal-header h2 {
            font-size: 20px;
            font-weight: 700;
            margin: 0;
            color: white;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
            position: relative;
            z-index: 1;
        }

        .close {
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            color: white;
            opacity: 0.8;
            transition: all 0.3s ease;
            position: relative;
            z-index: 1;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
        }
        
        .close:hover {
            opacity: 1;
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.1);
        }

        .close:hover {
            opacity: 1;
            color: #374151;
        }

        .modal-body {
            padding: 30px;
        }


        /* 체크박스 필터 스타일 */
        .filter-section {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 15px rgba(0,0,0,0.08);
            margin-bottom: 20px;
        }

        .filter-checkboxes {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }

        .filter-checkbox {
            display: flex;
            align-items: center;
            padding: 6px 12px;
            background: #f0f2f5;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .filter-checkbox:hover {
            background: #e3f2fd;
        }

        .filter-checkbox input[type="checkbox"] {
            margin-right: 6px;
            cursor: pointer;
        }

        .filter-checkbox label {
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
        }

        .filter-checkbox.active {
            background: #1565c0;
            color: white;
        }

        /* 임베디드 콘텐츠 스타일 */
        .embedded-content {
            display: none;
            margin-top: 20px;
        }

        .embedded-content.active {
            display: block;
        }

        .iframe-container {
            width: 100%;
            background: white;
            border-radius: 12px;
            overflow: hidden;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
        }

        .iframe-stats {
            height: 300px;
        }

        .iframe-jobs {
            height: 800px;
        }

        iframe {
            width: 100%;
            height: 100%;
            border: none;
        }

        .modal-info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .modal-info-item {
            padding: 16px;
            background: #f9fafb;
            border-radius: 8px;
            border-left: 4px solid #3b82f6;
        }

        .modal-info-label {
            font-size: 13px;
            font-weight: 500;
            color: #6b7280;
            margin-bottom: 4px;
        }

        .modal-info-value {
            font-size: 14px;
            color: #111827;
            font-weight: 500;
        }

        .modal-section {
            margin-bottom: 25px;
        }

        .modal-section h3 {
            color: #111827;
            margin-bottom: 12px;
            font-size: 16px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .modal-section-content {
            background: #f9fafb;
            padding: 16px;
            border-radius: 8px;
            line-height: 1.6;
            color: #374151;
        }

        .modal-files {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .file-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            transition: all 0.2s ease;
        }

        .file-item:hover {
            border-color: #3b82f6;
            background: #f8fafc;
        }

        .modal-actions {
            display: flex;
            gap: 15px;
            padding: 25px 35px;
            background: linear-gradient(145deg, #f8fafc, #f1f5f9);
            border-top: 2px solid #e2e8f0;
            position: relative;
        }
        
        .modal-actions::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, #667eea, transparent);
        }

        .modal-btn {
            flex: 1;
            padding: 12px 20px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .modal-btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
            border-radius: 25px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .modal-btn-primary:hover {
            background: linear-gradient(135deg, #764ba2, #667eea);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .modal-btn-secondary {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
            border-radius: 25px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .modal-btn-secondary:hover {
            background: linear-gradient(135deg, #059669, #047857);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(16, 185, 129, 0.4);
        }
        
        .modal-btn-secondary.bookmarked {
            background: linear-gradient(135deg, #fbbf24, #f59e0b);
            color: white;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.2);
            box-shadow: 0 4px 15px rgba(251, 191, 36, 0.4);
        }
        
        .modal-btn-secondary.bookmarked:hover {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(251, 191, 36, 0.5);
        }
        
        /* 첨부파일 스타일 */
        .file-item-enhanced {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            margin-bottom: 10px;
            background: linear-gradient(145deg, #ffffff, #f8fafc);
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
            transition: all 0.3s ease;
        }
        
        .file-item-enhanced:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.15);
            border-color: #667eea;
        }
        
        .file-name-link {
            color: #0066cc;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.2s;
        }
        
        .file-name-link:hover {
            text-decoration: underline;
            color: #0052a3;
        }
        
        .file-info {
            display: flex;
            align-items: center;
            gap: 8px;
            flex: 1;
        }
        
        .file-name {
            font-size: 13px;
            color: #374151;
            font-weight: 500;
        }
        
        .file-size {
            font-size: 11px;
            color: #9ca3af;
            margin-left: auto;
            margin-right: 10px;
        }
        
        .file-actions {
            display: flex;
            gap: 6px;
        }
        
        .file-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .file-btn-view {
            background: #3b82f6;
            color: white;
        }
        
        .file-btn-view:hover {
            background: #2563eb;
        }
        
        .file-btn-download {
            background: #10b981;
            color: white;
        }
        
        .file-btn-download:hover {
            background: #059669;
        }
        
        /* PDF 뷰어 모달 */
        .pdf-modal-content {
            background: white;
            width: 90vw;
            height: 90vh;
            border-radius: 12px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            box-shadow: 0 25px 80px rgba(0, 0, 0, 0.4);
        }
        
        .pdf-modal-header {
            background: linear-gradient(135deg, #667eea, #764ba2);
            padding: 15px 20px;
            border-bottom: none;
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: white;
        }
        
        .pdf-modal-header h3 {
            margin: 0;
            color: white;
            font-size: 16px;
            font-weight: 600;
        }
        
        .pdf-modal-header > div {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .pdf-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }
        
        .pdf-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-1px);
        }
        
        .pdf-close {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            font-size: 20px;
            cursor: pointer;
            color: white;
            padding: 8px;
            border-radius: 50%;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }
        
        .pdf-close:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }
        
        .pdf-modal-body {
            flex: 1;
            position: relative;
            background: #f8f9fa;
        }
        
        .pdf-modal-body iframe {
            border: none;
            background: white;
        }
        
        /* PDF 모달 애니메이션 */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: scale(0.9);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }
        
        /* 관련 링크 스타일 */
        .modal-links-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .link-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px;
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
        }
        
        .link-icon {
            font-size: 14px;
        }
        
        .link-text {
            color: #2563eb;
            text-decoration: none;
            font-size: 13px;
            flex: 1;
        }
        
        .link-text:hover {
            color: #1d4ed8;
            text-decoration: underline;
        }
        
        .link-type {
            font-size: 11px;
            color: #9ca3af;
            background: #f3f4f6;
            padding: 2px 6px;
            border-radius: 3px;
        }
        
        .no-links {
            text-align: center;
            color: #9ca3af;
            font-size: 13px;
            padding: 20px;
        }
        
        /* 기관 유형 필터 */
        .agency-filter {
            display: flex;
            gap: 15px;
            margin-top: 25px;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .filter-info {
            width: 100%;
            text-align: center;
            margin: 15px 0 10px 0;
            font-size: 16px;
            font-weight: 600;
            color: #1e3a8a;
            letter-spacing: -0.3px;
            animation: fadeInUp 0.8s ease;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .filter-item {
            border-radius: 10px;
            padding: 10px 16px;
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            border: 2px solid transparent;
        }
        
        .filter-item:nth-child(1) {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
        }
        
        .filter-item:nth-child(2) {
            background: linear-gradient(135deg, #10b981, #059669);
        }
        
        .filter-item:nth-child(3) {
            background: linear-gradient(135deg, #f59e0b, #d97706);
        }
        
        .filter-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
            border-color: rgba(255, 255, 255, 0.3);
        }
        
        .filter-item.active {
            border-color: rgba(255, 255, 255, 0.6);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
        }
        
        .agency-checkbox {
            width: 16px;
            height: 16px;
            cursor: pointer;
        }
        
        .filter-label {
            color: white;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            user-select: none;
        }
        
        .filter-label:hover {
            color: #f0f9ff;
        }

        .filter-item.disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .filter-item.disabled:hover {
            transform: translateY(-1px);
            opacity: 0.7;
        }

        .agency-checkbox:disabled {
            cursor: not-allowed;
        }

        /* 연결 예정 메시지 스타일 */
        .connecting-soon-message {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 400;
            z-index: 9999;
            opacity: 0;
            transition: opacity 0.2s ease-in-out;
            pointer-events: none;
            font-family: 'Pretendard Variable', 'Pretendard', 'Noto Sans KR', sans-serif;
        }
        
        .connecting-soon-message.show {
            opacity: 1;
        }
        
        /* 페이지네이션 */
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin: 40px 0;
            padding: 20px;
            font-size: 14px;
        }
        
        .pagination-btn {
            background: none;
            color: #666;
            border: none;
            padding: 0;
            font-size: 14px;
            cursor: pointer;
            transition: opacity 0.2s;
        }
        
        .pagination-btn:hover:not(:disabled) {
            opacity: 0.7;
            text-decoration: underline;
        }
        
        .pagination-btn:disabled {
            color: #ccc;
            cursor: not-allowed;
        }
        
        .pagination-numbers {
            display: flex;
            gap: 15px;
        }
        
        .page-number {
            background: none;
            color: #666;
            border: none;
            padding: 0;
            font-size: 14px;
            cursor: pointer;
            transition: opacity 0.2s;
        }
        
        .page-number:hover {
            opacity: 0.7;
            text-decoration: underline;
        }
        
        .page-number.active {
            color: #000;
            font-weight: 600;
            cursor: default;
            text-decoration: none;
        }

        /* 반응형 */
        @media (max-width: 768px) {
            .container {
                padding: 0 15px;
            }
            
            .header h1 {
                font-size: 24px;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
            }
            
            .jobs-grid {
                grid-template-columns: 1fr;
            }
            
            .controls {
                flex-direction: column;
                align-items: stretch;
            }

            .search-box {
                min-width: auto;
            }
        }

        .error-message {
            background: #fff5f5;
            border: 1px solid #fc8181;
            color: #c53030;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            text-align: center;
        }
        
        /* 새로운 모달 레이아웃 */
        .modal-content-layout {
            display: flex;
            gap: 30px;
            min-height: 400px;
        }
        
        .modal-left-panel {
            flex: 0 0 400px;
            background: linear-gradient(145deg, #f8fafc, #f1f5f9);
            border-radius: 16px;
            padding: 25px;
            box-shadow: 
                inset 0 2px 10px rgba(0, 0, 0, 0.05),
                0 4px 15px rgba(0, 0, 0, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.5);
        }
        
        .modal-right-panel {
            flex: 1;
        }
        
        .modal-info-section {
            margin-bottom: 25px;
        }
        
        .modal-info-section h3 {
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 18px;
            font-size: 17px;
            font-weight: 700;
            padding-bottom: 12px;
            border-bottom: 3px solid;
            border-image: linear-gradient(135deg, #667eea, #764ba2) 1;
            position: relative;
        }
        
        .modal-info-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .modal-info-row {
            display: flex;
            align-items: center;
            padding: 8px 0;
        }
        
        .modal-info-label {
            flex: 0 0 120px;
            font-size: 13px;
            font-weight: 500;
            color: #6b7280;
        }
        
        .modal-info-value {
            flex: 1;
            font-size: 14px;
            background: linear-gradient(135deg, #1f2937, #374151);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 600;
        }
        
        .modal-files-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .file-item-compact {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            font-size: 13px;
        }
        
        .file-icon {
            font-size: 16px;
        }
        
        .file-name {
            flex: 1;
            color: #374151;
        }
        
        .file-size {
            color: #9ca3af;
            font-size: 12px;
        }
        
        .no-files {
            color: #9ca3af;
            font-style: italic;
            text-align: center;
            padding: 20px;
        }
        
        .modal-content-section h3 {
            color: #111827;
            margin-bottom: 15px;
            font-size: 16px;
            font-weight: 600;
            padding-bottom: 8px;
            border-bottom: 2px solid #e5e7eb;
        }
        
        .modal-content-body {
            background: linear-gradient(145deg, #f8fafc, #f1f5f9);
            padding: 25px;
            border-radius: 16px;
            line-height: 1.7;
            color: #374151;
            max-height: 500px;
            overflow-y: auto;
            box-shadow: 
                inset 0 2px 10px rgba(0, 0, 0, 0.05),
                0 4px 15px rgba(0, 0, 0, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.5);
        }
        
        .modal-content-body::-webkit-scrollbar {
            width: 6px;
        }
        
        .modal-content-body::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.05);
            border-radius: 3px;
        }
        
        .modal-content-body::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 3px;
        }
        
        /* 심플한 콘텐츠 스타일 */
        .modal-simple-content {
            padding: 20px;
            line-height: 1.7;
            color: #374151;
            font-size: 14px;
            max-height: 600px;
            overflow-y: auto;
        }

        /* 채용 상세내용 포맷팅 스타일 */
        .formatted-content {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.8;
        }

        .no-content {
            text-align: center;
            color: #6c757d;
            font-style: italic;
            padding: 20px;
        }

        .content-item {
            margin: 8px 0;
            display: flex;
            align-items: flex-start;
        }

        .content-number, .content-bullet, .content-circle, .content-dash {
            font-weight: bold;
            color: #495057;
            margin-right: 8px;
            flex-shrink: 0;
        }

        .content-number {
            color: #007bff;
            min-width: 25px;
        }

        .content-bullet {
            color: #28a745;
            min-width: 20px;
        }

        .content-circle {
            color: #dc3545;
            min-width: 20px;
        }

        .content-dash {
            color: #6c757d;
            min-width: 15px;
        }

        .content-title {
            font-weight: bold;
            font-size: 1.1em;
            color: #212529;
            margin: 16px 0 8px 0;
            padding: 8px 12px;
            background: linear-gradient(135deg, #e3f2fd, #f3e5f5);
            border-left: 4px solid #2196f3;
            border-radius: 4px;
        }

        .content-section-title {
            font-weight: bold;
            font-size: 1.05em;
            color: #495057;
            margin: 12px 0 6px 0;
            padding-bottom: 4px;
            border-bottom: 2px solid #dee2e6;
        }

        .content-paragraph {
            margin: 12px 0;
            text-align: justify;
        }

        .content-bold {
            color: #212529;
            background: rgba(255, 193, 7, 0.2);
            padding: 1px 3px;
            border-radius: 3px;
        }

        .content-emphasis {
            color: #6f42c1;
            background: rgba(111, 66, 193, 0.1);
            padding: 1px 3px;
            border-radius: 3px;
        }

        .content-date {
            color: #dc3545;
            font-weight: 600;
            background: rgba(220, 53, 69, 0.1);
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Consolas', monospace;
        }

        .content-time {
            color: #fd7e14;
            font-weight: 600;
            background: rgba(253, 126, 20, 0.1);
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Consolas', monospace;
        }

        .content-phone {
            color: #198754;
            font-weight: 600;
            background: rgba(25, 135, 84, 0.1);
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Consolas', monospace;
        }

        .content-email {
            color: #0d6efd;
            text-decoration: none;
            font-weight: 500;
            padding: 2px 6px;
            background: rgba(13, 110, 253, 0.1);
            border-radius: 4px;
            transition: all 0.2s ease;
        }

        .content-email:hover {
            background: rgba(13, 110, 253, 0.2);
            text-decoration: underline;
        }

        .content-link {
            color: #0d6efd;
            text-decoration: none;
            font-weight: 500;
            word-break: break-all;
            padding: 2px 6px;
            background: rgba(13, 110, 253, 0.1);
            border-radius: 4px;
            transition: all 0.2s ease;
        }

        .content-link:hover {
            background: rgba(13, 110, 253, 0.2);
            text-decoration: underline;
        }


        /* PDF 모달 추가 스타일 */
        .pdf-loading {
            text-align: center;
            padding: 50px;
            color: #666;
            font-size: 16px;
        }
        
        /* 반응형 - 작은 화면에서는 세로 배치 */
        @media (max-width: 1024px) {
            .modal-content-layout {
                flex-direction: column;
            }
            
            .modal-left-panel {
                flex: none;
            }
        }
    </style>
</head>
<body>
    <!-- 헤더 -->
    <div class="header">
        <div class="header-content">
            <div class="header-text">
                <h1 style="text-align: center;"><span class="header-icon">🏛️</span><span class="title-highlight">대한민국</span> <span class="title-special">공공일터</span> <span class="title-highlight">채용정보</span></h1>
                <!-- 기관 유형 필터 -->
                <div class="agency-filter">
                    <div class="filter-item">
                        <input type="checkbox" id="filter-government" class="agency-checkbox" checked onclick="toggleGovernmentContent()">
                        <label for="filter-government" class="filter-label" onclick="toggleGovernmentContent()">정부 기관</label>
                    </div>
                    <div class="filter-item disabled">
                        <input type="checkbox" id="filter-public" class="agency-checkbox" disabled onclick="showConnectingSoonMessage('공공기관')">
                        <label for="filter-public" class="filter-label" onclick="showConnectingSoonMessage('공공기관')">공공 기관</label>
                    </div>
                    <div class="filter-item disabled">
                        <input type="checkbox" id="filter-local" class="agency-checkbox" disabled onclick="showConnectingSoonMessage('지자체')">
                        <label for="filter-local" class="filter-label" onclick="showConnectingSoonMessage('지자체')">지자체</label>
                    </div>
                    <div class="filter-info">
                        🎯 국가, 공공기관, 지자체 채용정보 모두를 이 사이트에서 확인 가능~^^
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 메인 컨테이너 -->
    <div class="container">
        <!-- 통계 섹션 -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number clickable" id="totalJobs" onclick="filterByType('total')" title="전체 채용공고 보기">-</div>
                <div class="stat-label">전체 채용</div>
                <div class="stat-sublabel">(등록 30일전)</div>
            </div>
            <div class="stat-card urgent-stat">
                <div class="stat-number clickable" id="urgentJobs" onclick="filterByType('urgent')" title="임박한 채용공고만 보기">-</div>
                <div class="stat-label">임박</div>
                <div class="stat-sublabel">(마감 3일전)</div>
            </div>
            <div class="stat-card recent-stat">
                <div class="stat-number clickable" id="recentJobs" onclick="filterByType('new')" title="최근 채용공고만 보기">-</div>
                <div class="stat-label">최근 채용</div>
                <div class="stat-sublabel">(등록 7일전)</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="totalDepts">-</div>
                <div class="stat-label">등록기관</div>
                <div class="stat-sublabel">(중복제외)</div>
            </div>
        </div>

        <!-- 제어 패널 (검색창) -->
        <div class="controls">
            <div class="search-box">
                <input type="text" id="searchInput" placeholder="기관명이나 제목으로 검색하세요..." />
            </div>
            <button class="load-btn" id="loadBtn" onclick="loadJobs()">
                채용공고 불러오기
            </button>
        </div>

        <!-- 정부기관 콘텐츠 영역 (정부기관 선택시 표시) -->
        <div id="governmentContent" style="display: block;">
            <!-- 채용공고 섹션 -->
            <div id="defaultContent" class="jobs-section">
            <div class="jobs-header">
                <h2>최신 채용공고</h2>
            </div>
            <div class="jobs-container">
                <div id="jobsContainer" class="loading">
                    <div class="loading-spinner"></div>
                    <p>채용공고를 불러오는 중입니다...</p>
                </div>
            </div>
        </div>
        
            <!-- 페이지네이션 -->
            <div class="pagination" id="pagination" style="display: none;">
                <button class="pagination-btn" id="prevBtn" onclick="goToPage(currentPage - 1)">
                    ◀ 이전
                </button>
                <div class="pagination-numbers" id="paginationNumbers">
                    <!-- 페이지 번호들이 여기에 동적으로 생성 -->
                </div>
                <button class="pagination-btn" id="nextBtn" onclick="goToPage(currentPage + 1)">
                    다음 ▶
                </button>
            </div>
        </div>

        <!-- 공공기관 임베디드 콘텐츠 영역 (공공기관 선택시 표시) -->
        <div id="publicContent" style="display: none;">
            <!-- 임베디드 공간: 카드형 리스트와 페이지네이션만 -->
            <div class="embed-container">
                <iframe 
                    id="embedJobCards" 
                    src="http://localhost:8002/portal_cards_only.html"
                    style="width: 100%; min-height: 800px; border: none;"
                    title="카드형 리스트와 페이지네이션"
                    onload="requestChildData()">
                </iframe>
            </div>
        </div>
    </div>

    <!-- 상세보기 모달 -->
    <div id="jobModal" class="modal">
        <div class="modal-content">
            <div class="modal-content-wrapper">
                <div class="modal-header">
                    <h2 id="modalTitle">채용공고 상세정보</h2>
                    <span class="close">&times;</span>
                </div>
                <div class="modal-body" id="modalBody">
                    <!-- 상세 내용이 여기에 동적으로 삽입됩니다 -->
                </div>
            </div>
        </div>
    </div>

    <script>
        let allJobs = [];
        let filteredJobs = [];
        let currentPage = 1;
        const jobsPerPage = 12; // 한 페이지당 12개 게시글
        
        // 날짜 포맷팅 (YYYYMMDD -> YYYY-MM-DD)
        function formatDate(dateString) {
            if (!dateString || dateString.length !== 8) return dateString || '-';
            
            // 99991231인 경우 상시채용으로 표시
            if (dateString === '99991231') return '상시채용';
            
            const year = dateString.substring(0, 4);
            const month = dateString.substring(4, 6);
            const day = dateString.substring(6, 8);
            return `${year}-${month}-${day}`;
        }
        
        // D-Day 계산
        function calculateDDay(endDateString) {
            if (!endDateString || endDateString.length !== 8) return null;
            
            // 99991231인 경우 상시채용이므로 null 반환 (D-Day 표시 없음)
            if (endDateString === '99991231') return null;
            
            const year = parseInt(endDateString.substring(0, 4));
            const month = parseInt(endDateString.substring(4, 6)) - 1;
            const day = parseInt(endDateString.substring(6, 8));
            const endDate = new Date(year, month, day);
            
            // 대한민국 서울 시간대 기준으로 오늘 날짜 설정 (9월 12일)
            const koreaTime = new Date();
            koreaTime.setHours(koreaTime.getHours() + 9); // UTC+9 (한국 시간)
            const today = new Date('2024-09-12'); // 오늘 날짜를 9월 12일로 설정
            today.setHours(0, 0, 0, 0);
            endDate.setHours(0, 0, 0, 0);
            
            const diffTime = endDate - today;
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            return diffDays;
        }
        
        // D-Day 표시
        function formatDDay(dDay) {
            if (dDay === null) return null;
            if (dDay < 0) return '마감';
            if (dDay === 0) return '오늘마감';
            return `D-${dDay}`;
        }
        
        // D-Day 클래스 결정
        function getDDayClass(dDay, endDateString) {
            // 상시채용인 경우
            if (endDateString === '99991231') return 'permanent';
            if (dDay === null || dDay < 0) return 'expired';
            if (dDay === 0) return 'today'; // D-0 별도 스타일
            if (dDay <= 3) return 'urgent'; // D-1~D-3
            return 'normal';
        }
        
        // 기관명 해시를 기반으로 색상 클래스 결정
        function getOrgColorClass(deptName) {
            if (!deptName) return 'org-1';
            const hash = deptName.split('').reduce((a, b) => {
                a = ((a << 5) - a) + b.charCodeAt(0);
                return a & a;
            }, 0);
            return `org-${Math.abs(hash) % 10 + 1}`;
        }

        // 채용공고 렌더링 (페이지네이션 적용)
        function renderJobs(jobs) {
            const container = document.getElementById('jobsContainer');
            
            console.log('renderJobs 호출됨:', jobs ? jobs.length : 0, '건');
            
            if (!jobs || jobs.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 60px 20px; color: #7f8c8d;">
                        <h3>채용공고가 없습니다</h3>
                        <p>검색 조건을 변경하거나 새로고침해보세요.</p>
                    </div>
                `;
                document.getElementById('pagination').style.display = 'none';
                return;
            }
            
            // 페이지네이션 활성화 - 12개씩 표시
            const startIndex = (currentPage - 1) * jobsPerPage;
            const endIndex = startIndex + jobsPerPage;
            const currentPageJobs = jobs.slice(startIndex, endIndex);
            
            console.log('📝 renderJobs - 전체:', jobs.length, '현재페이지:', currentPageJobs.length, `(${startIndex+1}-${Math.min(endIndex, jobs.length)})`);
            
            const jobsHtml = currentPageJobs.map(job => {
                const dDay = calculateDDay(job.end_date);
                const dDayFormatted = job.end_date === '99991231' ? '상시채용' : formatDDay(dDay);
                const dDayClass = getDDayClass(dDay, job.end_date);
                
                // 기관명 축약 (긴 이름 처리)
                const shortDeptName = job.dept_name && job.dept_name.length > 20 
                    ? job.dept_name.substring(0, 20) + '...' 
                    : job.dept_name || '미확인';
                
                // 기관별 색상 클래스
                const orgColorClass = getOrgColorClass(job.dept_name);
                
                return `
                    <div class="job-card" onclick="showJobDetail('${job.idx}')">
                        <div class="job-header">
                            <div class="job-badges">
                                <span class="job-badge badge-new">NEW</span>
                                <span class="job-badge badge-org ${orgColorClass}">${shortDeptName}</span>
                            </div>
                            ${dDayFormatted ? `<div class="job-dday-badge ${dDayClass}">${dDayFormatted}</div>` : ''}
                        </div>
                        
                        <h3 class="job-title">${job.title || '제목 없음'}</h3>
                        
                        <div class="job-meta">
                            <div class="meta-item">
                                <span class="meta-icon">📋</span>
                                <span>채용직급: ${job.grade || ''}</span>
                            </div>
                            <div class="meta-item">
                                <span class="meta-icon">📍</span>
                                <span>근무지역: ${job.work_region || ''}</span>
                            </div>
                            <div class="meta-item">
                                <span class="meta-icon">👀</span>
                                <span>조회수: ${job.read_count || 0}</span>
                            </div>
                            <div class="meta-item">
                                <span class="meta-icon">📅</span>
                                <span>접수기간: ${formatDate(job.reg_date)} ~ ${formatDate(job.end_date)}</span>
                            </div>
                        </div>
                        
                        <div class="job-footer">
                            <div class="job-actions" style="margin-left: auto;">
                                <button class="btn btn-detail" onclick="event.stopPropagation(); showJobDetail('${job.idx}')">
                                    📋 상세내용 보기
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            
            container.innerHTML = `<div class="jobs-grid">${jobsHtml}</div>`;
            
            console.log('🎨 HTML 생성 완료 - 카드 수:', currentPageJobs.length);
            console.log('🔍 실제 DOM에서 카드 수:', container.querySelectorAll('.job-card').length);
            
            // 페이지네이션 업데이트
            updatePagination(jobs.length);
        }
        
        
        // 통계 업데이트 (API에서 가져온 데이터 사용)
        function updateStatistics(jobs) {
            // 클라이언트 사이드에서 직접 계산
            updateStatisticsClient(jobs);
        }
        
        // 클라이언트 사이드 통계 계산 (백업용)
        function updateStatisticsClient(jobs) {
            if (!jobs) return;
            
            // 대한민국 서울 시간대 기준 (9월 12일)
            const now = new Date('2024-09-12');
            const today = now.toISOString().slice(0, 10).replace(/-/g, '');
            
            // 30일 전 날짜 계산
            const thirtyDaysAgo = new Date(now);
            thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
            const thirtyDaysAgoStr = thirtyDaysAgo.toISOString().slice(0, 10).replace(/-/g, '');
            
            // 7일 전 날짜 계산  
            const sevenDaysAgo = new Date(now);
            sevenDaysAgo.setDate(sevenDaysAgo.getDate() - 7);
            const sevenDaysAgoStr = sevenDaysAgo.toISOString().slice(0, 10).replace(/-/g, '');
            
            // 전체 채용 (30일 기준)
            const totalJobs = jobs.filter(job => 
                job.reg_date && job.reg_date >= thirtyDaysAgoStr
            ).length;
            
            // 임박 채용 (마감 3일 전)
            const urgentJobs = jobs.filter(job => {
                const dDay = calculateDDay(job.end_date);
                return dDay !== null && dDay >= 0 && dDay <= 3;
            }).length;
            
            // 최근 채용 (7일 기준)
            const recentJobs = jobs.filter(job =>
                job.reg_date && job.reg_date >= sevenDaysAgoStr
            ).length;
            
            // 등록기관 (중복제외)
            const departments = new Set(
                jobs.map(job => job.dept_name).filter(name => name)
            ).size;
            
            document.getElementById('totalJobs').textContent = totalJobs;
            document.getElementById('urgentJobs').textContent = urgentJobs;
            document.getElementById('recentJobs').textContent = recentJobs;
            document.getElementById('totalDepts').textContent = departments;
        }

        // 채용 상세내용 포맷팅 함수
        function formatJobContent(content) {
            if (!content || content === '상세 채용 내용이 없습니다.') {
                return `<div class="no-content">상세 채용 내용이 없습니다.</div>`;
            }

            // HTML 특수 문자 이스케이프 (기본 보안)
            let formattedContent = content
                .replace(/&/g, '&amp;')
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;')
                .replace(/"/g, '&quot;')
                .replace(/'/g, '&#39;');

            // 모든 포맷팅 제거 - 완전히 원본 그대로

            // 강조 텍스트도 원본 그대로 유지

            // 날짜 및 시간도 색상 없이 원본 그대로 유지

            // 연락처 정보와 URL은 심플하게 원본 그대로 유지

            // 7. 단락 구분 (연속된 2개 이상의 줄바꿈을 단락으로 처리)
            formattedContent = formattedContent
                .split(/\n\s*\n/)
                .map(paragraph => {
                    if (paragraph.trim()) {
                        // 이미 div로 감싸진 내용은 그대로, 아닌 것만 p로 감싸기
                        if (paragraph.trim().startsWith('<div class="content-')) {
                            return paragraph.trim();
                        }
                        return `<p class="content-paragraph">${paragraph.trim().replace(/\n/g, '<br>')}</p>`;
                    }
                    return '';
                })
                .filter(p => p)
                .join('\n');

            // 8. 나머지 단일 줄바꿈 처리
            formattedContent = formattedContent.replace(/\n/g, '<br>');

            // 9. 빈 줄 정리
            formattedContent = formattedContent
                .replace(/(<br>\s*){3,}/g, '<br><br>')
                .replace(/^\s*<br>/gm, '')
                .replace(/<br>\s*$/gm, '');

            return formattedContent;
        }
        
        // 채용공고 로드 (Firebase 서버 API를 통해)
        async function loadJobs() {
            const container = document.getElementById('jobsContainer');
            const loadBtn = document.getElementById('loadBtn');
            
            // 로딩 상태로 변경
            container.innerHTML = `
                <div class="loading">
                    <div class="loading-spinner"></div>
                    <p>Firebase에서 최신 채용공고를 가져오고 있습니다...</p>
                </div>
            `;
            loadBtn.disabled = true;
            loadBtn.textContent = '불러오는 중...';
            
            try {
                console.log('🔥 Firebase에서 직접 데이터 로딩 중...');
                
                // Firebase에서 직접 데이터 가져오기
                const jobs = await getJobsFromFirebase();
                
                if (jobs && jobs.length > 0) {
                    allJobs = jobs;
                    filteredJobs = [...allJobs];
                    
                    console.log(`✅ ${allJobs.length}건의 채용공고 로드 완료`);
                    console.log('Firebase에서 가져온 첫 번째 데이터:', allJobs[0]);
                    
                    renderJobs(filteredJobs);
                    updateStatistics(allJobs);
                } else {
                    console.log('🔄 샘플 데이터로 대체합니다');
                    const sampleData = getSampleJobs();
                    allJobs = sampleData;
                    filteredJobs = [...allJobs];
                    renderJobs(filteredJobs);
                    updateStatistics(allJobs);
                }
                
            } catch (error) {
                console.error('❌ 데이터 로드 실패:', error);
                console.log('🔄 샘플 데이터로 대체합니다');
                
                // 오류시 샘플 데이터 표시
                const sampleData = getSampleJobs();
                allJobs = sampleData;
                filteredJobs = [...allJobs];
                renderJobs(filteredJobs);
                updateStatistics(allJobs);
                
                // 오류 메시지는 콘솔에만 표시하고 UI는 정상 작동
                console.warn('Firebase 연결 실패로 샘플 데이터를 표시합니다');
                
            } finally {
                loadBtn.disabled = false;
                loadBtn.textContent = '새로고침';
            }
        }

        // Firebase에서 채용공고 데이터 가져오기
        async function getJobsFromFirebase() {
            try {
                // Firebase 설정 (실제 프로젝트 정보)
                const firebaseConfig = {
                    apiKey: "AIzaSyBvK1xKEyy2K2QXz3Q3Y1e8M_3QV6xCNrI",
                    authDomain: "job-portal-c9d7f.firebaseapp.com",
                    projectId: "job-portal-c9d7f",
                    storageBucket: "job-portal-c9d7f.firebasestorage.app",
                    messagingSenderId: "891234567890",
                    appId: "1:891234567890:web:a1b2c3d4e5f6789012"
                };

                // Firebase 초기화 (이미 초기화되었는지 확인)
                let app;
                if (!firebase.apps || firebase.apps.length === 0) {
                    app = firebase.initializeApp(firebaseConfig);
                    console.log('✅ Firebase 앱 초기화 완료');
                } else {
                    app = firebase.app();
                    console.log('✅ 기존 Firebase 앱 사용');
                }

                const db = firebase.firestore();
                console.log('✅ Firestore 연결 완료');
                
                // jobs 컬렉션에서 데이터 가져오기
                const jobsSnapshot = await db.collection('jobs')
                    .orderBy('reg_date', 'desc')
                    .limit(1000)
                    .get();
                
                const jobs = [];
                let sampleIndex = 0;
                jobsSnapshot.forEach(doc => {
                    const data = doc.data();
                    
                    // 처음 3개 데이터의 모든 필드를 로그로 출력
                    if (sampleIndex < 3) {
                        console.log(`📋 샘플 데이터 ${sampleIndex + 1}번:`, data);
                        console.log('  - grade 필드:', data.grade);
                        console.log('  - job_grade 필드:', data.job_grade);
                        console.log('  - recruit_grade 필드:', data.recruit_grade);
                        console.log('  - position 필드:', data.position);
                        console.log('  - 모든 필드명:', Object.keys(data));
                        sampleIndex++;
                    }
                    
                    // 다양한 필드명 체크 (grade, job_grade, recruit_grade, position 등)
                    const gradeValue = data.grade || data.job_grade || data.recruit_grade || data.position || '';
                    
                    jobs.push({
                        idx: doc.id,
                        title: data.title || '제목 없음',
                        dept_name: data.dept_name || '기관명 없음',
                        work_region: data.work_region || '지역 정보 없음',
                        grade: gradeValue || '급수 정보 없음',
                        reg_date: data.reg_date || '',
                        end_date: data.end_date || '',
                        read_count: data.read_count || 0,
                        etc_info: data.etc_info || 'N||N',
                        contents: data.contents || '',
                        files: data.files || []
                    });
                });

                console.log('✅ Firebase에서 가져온 데이터:', jobs.length, '건');
                return jobs;

            } catch (error) {
                console.error('❌ Firebase 데이터 가져오기 실패:', error);
                
                // Firebase 연결 실패시 샘플 데이터 반환
                console.log('🔄 샘플 데이터로 대체');
                return getSampleJobs();
            }
        }

        // 샘플 채용공고 데이터 (Firebase 연결 실패시 대체)
        function getSampleJobs() {
            return [
                {
                    idx: 'sample1',
                    title: '2024년 서울특별시 9급 공무원 채용',
                    dept_name: '서울특별시',
                    work_region: '서울시 전체',
                    grade: '9급',
                    reg_date: '20241201',
                    end_date: '20241231',
                    read_count: 1520,
                    etc_info: 'Y||N'
                },
                {
                    idx: 'sample2',
                    title: '국민연금공단 계약직 직원 채용',
                    dept_name: '국민연금공단',
                    work_region: '전국',
                    grade: '7급 상당',
                    reg_date: '20241205',
                    end_date: '20241225',
                    read_count: 890,
                    etc_info: 'N||Y'
                },
                {
                    idx: 'sample3',
                    title: '인천광역시 교육청 교육전문직원 채용',
                    dept_name: '인천광역시교육청',
                    work_region: '인천시',
                    grade: '6급',
                    reg_date: '20241210',
                    end_date: '20241230',
                    read_count: 445,
                    etc_info: 'N||N'
                },
                {
                    idx: 'sample4',
                    title: '한국수력원자력(주) 신입직원 채용',
                    dept_name: '한국수력원자력',
                    work_region: '경주, 울진',
                    grade: '대졸신입',
                    reg_date: '20241215',
                    end_date: '20250115',
                    read_count: 2340,
                    etc_info: 'Y||Y'
                },
                {
                    idx: 'sample5',
                    title: '부산광역시 중구청 임기제공무원 채용',
                    dept_name: '부산광역시 중구청',
                    work_region: '부산시 중구',
                    grade: '8급',
                    reg_date: '20241218',
                    end_date: '20250105',
                    read_count: 678,
                    etc_info: 'N||N'
                }
            ];
        }
        
        // 검색 기능
        function searchJobs() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase().trim();
            
            if (!searchTerm) {
                filteredJobs = [...allJobs];
            } else {
                filteredJobs = allJobs.filter(job => {
                    const title = (job.title || '').toLowerCase();
                    const dept = (job.dept_name || '').toLowerCase();
                    return title.includes(searchTerm) || dept.includes(searchTerm);
                });
            }
            
            renderJobs(filteredJobs);
            updateStatistics(filteredJobs);
        }
        
        // 상세보기 모달
        function showJobDetail(jobIdx) {
            console.log('🔍 showJobDetail 호출됨:', jobIdx);
            console.log('📊 allJobs 데이터:', allJobs.length, '건');
            
            const modal = document.getElementById('jobModal');
            const modalTitle = document.getElementById('modalTitle');
            const modalBody = document.getElementById('modalBody');
            
            console.log('🎯 모달 요소들:', {modal, modalTitle, modalBody});
            
            if (!modal || !modalTitle || !modalBody) {
                console.error('❌ 모달 요소를 찾을 수 없습니다');
                return;
            }
            
            modal.style.display = 'block';
            console.log('✅ 모달 표시됨');
            
            // allJobs 배열에서 해당 job 찾기
            console.log('🔍 찾고있는 jobIdx:', jobIdx, typeof jobIdx);
            console.log('🔍 allJobs idx들:', allJobs.map(j => ({idx: j.idx, type: typeof j.idx})));
            
            const job = allJobs.find(j => j.idx === jobIdx);
            console.log('🎯 찾은 job:', job);
            
            if (!job) {
                console.error('❌ 해당 게시글을 찾을 수 없습니다:', jobIdx);
                modalTitle.textContent = '오류';
                modalBody.innerHTML = '<div class="error">해당 게시글을 찾을 수 없습니다.</div>';
                return;
            }
            
            modalTitle.textContent = job.title || '제목 없음';
            
            // Firebase에서 가져온 데이터 직접 사용
            const rawContent = job.contents || '상세 채용 내용이 없습니다.';
            const detailContent = formatJobContent(rawContent);
            const filesList = job.files || [];
                    
                    modalBody.innerHTML = `
                        <div class="modal-content-layout">
                            <!-- 왼쪽: 기본 정보 -->
                            <div class="modal-left-panel">
                                <div class="modal-info-section">
                                    <h3>📋 기본정보</h3>
                                    <div class="modal-info-list">
                                        <div class="modal-info-row">
                                            <span class="modal-info-label">기관명:</span>
                                            <span class="modal-info-value">${job.dept_name || '미확인'}</span>
                                        </div>
                                        <div class="modal-info-row">
                                            <span class="modal-info-label">조회수:</span>
                                            <span class="modal-info-value">${job.read_count || 0}</span>
                                        </div>
                                        <div class="modal-info-row">
                                            <span class="modal-info-label">등록일:</span>
                                            <span class="modal-info-value">${formatDate(job.reg_date) || '미확인'}</span>
                                        </div>
                                        <div class="modal-info-row">
                                            <span class="modal-info-label">마감일:</span>
                                            <span class="modal-info-value">${formatDate(job.end_date) || '미확인'}</span>
                                        </div>
                                        <div class="modal-info-row">
                                            <span class="modal-info-label">채용직급:</span>
                                            <span class="modal-info-value">${job.grade || ''}</span>
                                        </div>
                                        <div class="modal-info-row">
                                            <span class="modal-info-label">근무지역:</span>
                                            <span class="modal-info-value">${job.work_region || ''}</span>
                                        </div>
                                        <div class="modal-info-row">
                                            <span class="modal-info-label">장애인채용/우대:</span>
                                            <span class="modal-info-value">${job.etc_info && job.etc_info !== 'N||N' ? job.etc_info : '해당없음'}</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- 첨부파일 섹션 -->
                                <div class="modal-info-section">
                                    <h3>📎 첨부파일</h3>
                                    <div class="modal-files-list">
                                        ${filesList.length > 0 ? filesList.map(file => {
                                            // API에서 제공하는 완전한 다운로드 URL 사용
                                            const downloadUrl = file.download_url || file.filepath || '#';
                                            const isPDF = file.filename.toLowerCase().endsWith('.pdf');
                                            
                                            return `
                                            <div class="file-item-enhanced">
                                                <div class="file-info">
                                                    <span class="file-icon">${getFileIcon(file.filename)}</span>
                                                    <a href="${downloadUrl}" target="_blank" class="file-name-link" style="color: #0066cc; text-decoration: none; hover: underline;">
                                                        ${file.filename}
                                                    </a>
                                                    <span class="file-size">${file.filesize || ''}</span>
                                                </div>
                                                <div class="file-actions">
                                                    <button class="file-btn file-btn-download" onclick="downloadFile('${downloadUrl}', '${file.filename}')" title="다운로드">
                                                        📥 다운로드
                                                    </button>
                                                </div>
                                            </div>
                                            `;
                                        }).join('') : '<p class="no-files">첨부파일이 없습니다</p>'}
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 오른쪽: 상세 내용 -->
                            <div class="modal-right-panel">
                                <div class="modal-simple-content">
                                    ${detailContent}
                                </div>
                            </div>
                        </div>
                    `;
            
            // 모달 하단에 액션 버튼 추가  
            setTimeout(() => {
                const modalContentWrapper = document.querySelector('.modal-content-wrapper');
                if (modalContentWrapper && !modalContentWrapper.querySelector('.modal-actions')) {
                    const actionsDiv = document.createElement('div');
                    actionsDiv.className = 'modal-actions';
                    const jobUrl = `https://www.gojobs.go.kr/apmView.do?empmnsn=${jobIdx}&selMenuNo=400&menuNo=401&upperMenuNo=`;
                    
                    // 북마크 상태 확인
                    const bookmarks = getBookmarks();
                    const isBookmarked = bookmarks.includes(jobIdx);
                    const bookmarkText = isBookmarked ? '★ 북마크됨' : '⭐ 북마크';
                    const bookmarkClass = isBookmarked ? 'modal-btn-secondary bookmarked' : 'modal-btn-secondary';
                    
                    actionsDiv.innerHTML = `
                        <button class="modal-btn modal-btn-primary" onclick="applyToJob('${jobIdx}')">✏️ 지원하기</button>
                        <button class="modal-btn ${bookmarkClass}" onclick="toggleBookmark('${jobIdx}', this)">${bookmarkText}</button>
                    `;
                    modalContentWrapper.appendChild(actionsDiv);
                }
            }, 100);
        }
        
        
        // 모달 닫기
        function closeModal() {
            document.getElementById('jobModal').style.display = 'none';
            // 모달 닫기 시 새로고침 제거 - 현재 상태 유지
        }
        
        // 북마크 기능
        function toggleBookmark(jobIdx, buttonElement) {
            const bookmarks = getBookmarks();
            const isBookmarked = bookmarks.includes(jobIdx);
            
            if (isBookmarked) {
                // 북마크 제거
                const updatedBookmarks = bookmarks.filter(id => id !== jobIdx);
                localStorage.setItem('job_bookmarks', JSON.stringify(updatedBookmarks));
                buttonElement.innerHTML = '⭐ 북마크';
                buttonElement.classList.remove('bookmarked');
                showToast('북마크가 제거되었습니다', 'info');
            } else {
                // 북마크 추가
                bookmarks.push(jobIdx);
                localStorage.setItem('job_bookmarks', JSON.stringify(bookmarks));
                buttonElement.innerHTML = '★ 북마크됨';
                buttonElement.classList.add('bookmarked');
                showToast('북마크에 추가되었습니다', 'success');
            }
        }
        
        // 북마크 목록 가져오기
        function getBookmarks() {
            const bookmarks = localStorage.getItem('job_bookmarks');
            return bookmarks ? JSON.parse(bookmarks) : [];
        }
        
        // 토스트 메시지 표시
        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            toast.textContent = message;
            
            // 토스트 스타일
            toast.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${type === 'success' ? '#10b981' : type === 'error' ? '#ef4444' : '#6b7280'};
                color: white;
                padding: 12px 20px;
                border-radius: 8px;
                z-index: 10000;
                font-size: 14px;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
                transform: translateX(100%);
                transition: transform 0.3s ease;
            `;
            
            document.body.appendChild(toast);
            
            // 애니메이션으로 표시
            setTimeout(() => {
                toast.style.transform = 'translateX(0)';
            }, 100);
            
            // 3초 후 제거
            setTimeout(() => {
                toast.style.transform = 'translateX(100%)';
                setTimeout(() => {
                    if (toast.parentNode) {
                        toast.parentNode.removeChild(toast);
                    }
                }, 300);
            }, 3000);
        }
        
        // 페이지네이션 업데이트
        function updatePagination(totalJobs) {
            const totalPages = Math.ceil(totalJobs / jobsPerPage);
            const pagination = document.getElementById('pagination');
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            const numbersContainer = document.getElementById('paginationNumbers');
            
            if (totalPages <= 1) {
                pagination.style.display = 'none';
                return;
            }
            
            pagination.style.display = 'flex';
            
            // 이전/다음 버튼 상태
            prevBtn.disabled = currentPage <= 1;
            nextBtn.disabled = currentPage >= totalPages;
            
            // 페이지 번호 생성
            let numbersHtml = '';
            const showPages = 5; // 표시할 페이지 번호 개수
            let startPage = Math.max(1, currentPage - Math.floor(showPages / 2));
            let endPage = Math.min(totalPages, startPage + showPages - 1);
            
            if (endPage - startPage + 1 < showPages) {
                startPage = Math.max(1, endPage - showPages + 1);
            }
            
            for (let i = startPage; i <= endPage; i++) {
                const activeClass = i === currentPage ? 'active' : '';
                numbersHtml += `<button class="page-number ${activeClass}" onclick="goToPage(${i})">${i}</button>`;
            }
            
            numbersContainer.innerHTML = numbersHtml;
        }
        
        // 연결 예정 메시지 표시
        function showComingSoonMessage() {
            // 기존 메시지가 있으면 제거
            const existingMessage = document.querySelector('.coming-soon-message');
            if (existingMessage) {
                existingMessage.remove();
            }
            
            // 메시지 엘리먼트 생성
            const message = document.createElement('div');
            message.className = 'coming-soon-message';
            message.textContent = '연결 예정';
            message.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: rgba(0, 0, 0, 0.8);
                color: white;
                padding: 12px 24px;
                border-radius: 8px;
                font-size: 14px;
                font-weight: 500;
                z-index: 10000;
                opacity: 0;
                transition: opacity 0.3s ease;
            `;
            
            document.body.appendChild(message);
            
            // 페이드 인
            setTimeout(() => {
                message.style.opacity = '1';
            }, 10);
            
            // 0.5초 후 페이드 아웃 후 제거
            setTimeout(() => {
                message.style.opacity = '0';
                setTimeout(() => {
                    if (document.body.contains(message)) {
                        document.body.removeChild(message);
                    }
                }, 300);
            }, 500);
        }

        // 공공기관 콘텐츠 토글
        function togglePublicContent() {
            const publicCheckbox = document.getElementById('filter-public');
            const governmentCheckbox = document.getElementById('filter-government');
            const publicContent = document.getElementById('publicContent');
            const governmentContent = document.getElementById('governmentContent');
            
            if (publicCheckbox.checked) {
                // 공공기관 체크 시
                governmentCheckbox.checked = false;
                publicContent.style.display = 'block';
                governmentContent.style.display = 'none';
                
                // 공공기관 통계 로드
                loadPublicStats();
                
                // iframe 로드
                loadEmbeddedContent();
            } else {
                // 공공기관 체크 해제 시 - 정부기관 자동 체크
                governmentCheckbox.checked = true;
                publicContent.style.display = 'none';
                governmentContent.style.display = 'block';
                
                // 정부기관 통계 로드
                loadGovernmentStats();
            }
        }
        
        function loadEmbeddedContent() {
            const jobCardsIframe = document.getElementById('embedJobCards');
            
            // portal_v1.html에서 em2 영역만 가져오기
            // em2: 채용공고 카드 + 페이지네이션
            
            if (!jobCardsIframe.src || jobCardsIframe.src !== 'http://localhost:3001/portal_v1.html#em2') {
                jobCardsIframe.src = 'http://localhost:3001/portal_v1.html#em2';
                
                // iframe 로드 완료 이벤트 추가
                jobCardsIframe.addEventListener('load', function() {
                    console.log('jobCardsIframe 로드 완료');
                });
            }
            
            // iframe 간 통신 설정
            setupIframeCommunication();
        }
        
        // 정부기관 콘텐츠 토글
        function toggleGovernmentContent() {
            const publicCheckbox = document.getElementById('filter-public');
            const governmentCheckbox = document.getElementById('filter-government');
            const publicContent = document.getElementById('publicContent');
            const governmentContent = document.getElementById('governmentContent');
            
            if (governmentCheckbox.checked) {
                // 정부기관 체크 시 - 기본 콘텐츠 표시
                publicCheckbox.checked = false;
                publicContent.style.display = 'none';
                governmentContent.style.display = 'block';
                
                // 정부기관 통계 로드
                loadGovernmentStats();
            } else {
                // 정부기관 체크 해제 시 - 공공기관 자동 체크
                publicCheckbox.checked = true;
                publicContent.style.display = 'block';
                governmentContent.style.display = 'none';
                
                // 공공기관 통계 로드
                loadPublicStats();
                
                loadEmbeddedContent();
            }
        }

        // iframe 간 통신 설정
        function setupIframeCommunication() {
            window.addEventListener('message', function(event) {
                const searchStatsIframe = document.getElementById('embedSearchStats');
                const jobCardsIframe = document.getElementById('embedJobCards');
                
                // 검색/통계 iframe에서 온 메시지를 카드 iframe으로 전달
                if (searchStatsIframe && searchStatsIframe.contentWindow && 
                    event.source === searchStatsIframe.contentWindow) {
                    if (jobCardsIframe && jobCardsIframe.contentWindow) {
                        jobCardsIframe.contentWindow.postMessage(event.data, '*');
                    }
                }
                
                // 카드 iframe에서 상세보기 요청이 온 경우
                if (event.data.type === 'showJobDetail') {
                    showJobDetailModal(event.data.job);
                }
            });
        }
        
        // 채용공고 상세보기 모달 표시
        function showJobDetailModal(job) {
            const modal = document.getElementById('jobModal');
            const modalTitle = document.getElementById('modalTitle');
            const modalBody = document.getElementById('modalBody');

            modalTitle.textContent = job.title || '채용공고 상세';
            
            const formatDate = (dateStr) => {
                if (!dateStr) return '정보 없음';
                return dateStr.replace(/(\d{4})(\d{2})(\d{2})/, '$1-$2-$3');
            };

            modalBody.innerHTML = `
                <div style="margin-bottom: 20px;">
                    <h3>기관 정보</h3>
                    <p><strong>기관명:</strong> ${job.department_name || '정보 없음'}</p>
                    <p><strong>부서명:</strong> ${job.division_name || '정보 없음'}</p>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <h3>채용 정보</h3>
                    <p><strong>채용제목:</strong> ${job.title || '정보 없음'}</p>
                    <p><strong>고용형태:</strong> ${job.employment_type || '정보 없음'}</p>
                    <p><strong>채용인원:</strong> ${job.recruitment_number || '정보 없음'}</p>
                    <p><strong>근무지역:</strong> ${job.work_region || '정보 없음'}</p>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <h3>접수 기간</h3>
                    <p><strong>시작일:</strong> ${formatDate(job.start_date)}</p>
                    <p><strong>마감일:</strong> ${formatDate(job.end_date)}</p>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <h3>상세 내용</h3>
                    <p>${job.content || '상세 내용이 없습니다.'}</p>
                </div>
                
                ${job.original_url ? `
                    <div style="margin-bottom: 20px;">
                        <h3>원문 보기</h3>
                        <p><a href="${job.original_url}" target="_blank" style="color: #1565c0;">
                            원문 페이지로 이동 →
                        </a></p>
                    </div>
                ` : ''}
            `;

            modal.style.display = 'flex';
        }

        // 페이지 이동
        function goToPage(page) {
            const totalPages = Math.ceil(filteredJobs.length / jobsPerPage);
            
            if (page < 1 || page > totalPages) return;
            
            currentPage = page;
            renderJobs(filteredJobs);
        }
        
        // 통계 필터링 함수 (버전1.3 방식)
        async function filterByType(type) {
            console.log(`${type} 필터링 시작`);
            
            let currentJobs = [];
            const publicCheckbox = document.getElementById('filter-public');
            const isPublicMode = publicCheckbox && publicCheckbox.checked;
            
            // 데이터 소스 결정
            if (isPublicMode) {
                // 공공기관 모드: API에서 실시간 데이터 가져오기
                try {
                    const response = await fetch('http://localhost:3001/api/jobs?limit=300');
                    if (response.ok) {
                        const jobsData = await response.json();
                        currentJobs = jobsData.jobs || [];
                    }
                } catch (error) {
                    console.error('공공기관 데이터 로드 실패:', error);
                    return;
                }
            } else {
                // 정부기관 모드: 기존 allJobs 사용
                currentJobs = [...allJobs];
            }
            
            let filteredData = [];
            // 대한민국 서울 시간대 기준으로 오늘 날짜 설정 (9월 12일)
            const koreaTime = new Date();
            koreaTime.setHours(koreaTime.getHours() + 9); // UTC+9 (한국 시간)
            const today = new Date('2024-09-12'); // 오늘 날짜를 9월 12일로 설정
            
            switch(type) {
                case 'total':
                    filteredData = [...currentJobs];
                    break;
                    
                case 'urgent':
                    // 마감 3일 이내 필터링
                    filteredData = currentJobs.filter(job => {
                        if (!job.end_date || job.end_date.length !== 8) return false;
                        if (job.end_date === '99991231') return false;
                        
                        const year = parseInt(job.end_date.substring(0, 4));
                        const month = parseInt(job.end_date.substring(4, 6)) - 1;
                        const day = parseInt(job.end_date.substring(6, 8));
                        const endDate = new Date(year, month, day);
                        
                        today.setHours(0, 0, 0, 0);
                        endDate.setHours(0, 0, 0, 0);
                        
                        const diffTime = endDate - today;
                        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                        
                        return diffDays >= 0 && diffDays <= 3;
                    });
                    break;
                    
                case 'new':
                    // 최근 7일 내 등록 필터링
                    const sevenDaysAgo = new Date(today.getTime() - 7 * 24 * 60 * 60 * 1000);
                    filteredData = currentJobs.filter(job => {
                        if (!job.reg_date || job.reg_date.length !== 8) return false;
                        
                        const year = parseInt(job.reg_date.substring(0, 4));
                        const month = parseInt(job.reg_date.substring(4, 6)) - 1;
                        const day = parseInt(job.reg_date.substring(6, 8));
                        const regDate = new Date(year, month, day);
                        
                        return regDate >= sevenDaysAgo;
                    });
                    break;
            }
            
            console.log(`${type} 필터링 결과:`, filteredData.length, '건');
            console.log('필터링된 데이터 샘플:', filteredData.slice(0, 2));
            
            if (isPublicMode) {
                // 공공기관 모드: iframe에 데이터 전송
                const actionMap = {
                    'total': 'filterTotal',
                    'urgent': 'filterUrgent', 
                    'new': 'filterNew'
                };
                
                const message = { 
                    action: actionMap[type], 
                    jobs: filteredData 
                };
                
                console.log('iframe으로 전송할 메시지:', message);
                sendMessageToIframe(message);
                
                // 통계 박스 전체 업데이트 (모든 수치를 다시 계산)
                updateAllStats(currentJobs, type, filteredData.length);
            } else {
                // 정부기관 모드: 직접 렌더링
                filteredJobs = filteredData;
                currentPage = 1;
                renderJobs(filteredJobs);
            }
            
            // 스크롤 이동
            if (isPublicMode) {
                // iframe 필터링만 수행 (스크롤 제거)
                const iframe = document.getElementById('embedJobCards');
            } else {
                // 일반 필터링 (스크롤 제거)
            }
        }
        
        // 통계 박스 전체 업데이트 함수
        function updateAllStats(allData, currentFilter, currentCount) {
            console.log('통계 업데이트 시작 - 전체 데이터:', allData.length, '건');
            
            // 대한민국 서울 시간대 기준으로 오늘 날짜 설정 (9월 12일)
            const koreaTime = new Date();
            koreaTime.setHours(koreaTime.getHours() + 9); // UTC+9 (한국 시간)
            const today = new Date('2024-09-12'); // 오늘 날짜를 9월 12일로 설정
            today.setHours(0, 0, 0, 0);
            
            // 전체 채용 (30일 기준)
            const totalJobs = allData.length;
            
            // 임박 채용 (마감 3일 이내)
            const urgentJobs = allData.filter(job => {
                if (!job.end_date || job.end_date.length !== 8) return false;
                if (job.end_date === '99991231') return false;
                
                const year = parseInt(job.end_date.substring(0, 4));
                const month = parseInt(job.end_date.substring(4, 6)) - 1;
                const day = parseInt(job.end_date.substring(6, 8));
                const endDate = new Date(year, month, day);
                endDate.setHours(0, 0, 0, 0);
                
                const diffTime = endDate - today;
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                
                return diffDays >= 0 && diffDays <= 3;
            }).length;
            
            // 최근 채용 (7일 이내 등록)
            const sevenDaysAgo = new Date(today.getTime() - 7 * 24 * 60 * 60 * 1000);
            const recentJobs = allData.filter(job => {
                if (!job.reg_date || job.reg_date.length !== 8) return false;
                
                const year = parseInt(job.reg_date.substring(0, 4));
                const month = parseInt(job.reg_date.substring(4, 6)) - 1;
                const day = parseInt(job.reg_date.substring(6, 8));
                const regDate = new Date(year, month, day);
                
                return regDate >= sevenDaysAgo;
            }).length;
            
            // 등록 기관 수
            const uniqueOrgs = new Set(allData.map(job => job.dept_name)).size;
            
            // 통계 박스 업데이트
            document.getElementById('totalJobs').textContent = totalJobs;
            document.getElementById('urgentJobs').textContent = urgentJobs;  
            document.getElementById('recentJobs').textContent = recentJobs;
            document.getElementById('totalDepts').textContent = uniqueOrgs;
            
            console.log('통계 업데이트 완료:', {
                total: totalJobs,
                urgent: urgentJobs,
                recent: recentJobs,
                orgs: uniqueOrgs,
                currentFilter: currentFilter,
                currentCount: currentCount
            });
        }

        // iframe에 메시지 전송 함수
        function sendMessageToIframe(message, retryCount = 0) {
            const maxRetries = 10;
            const iframe = document.getElementById('embedJobCards');
            
            if (retryCount >= maxRetries) {
                console.error('iframe 메시지 전송 최대 재시도 횟수 초과');
                return;
            }
            
            if (iframe && iframe.contentWindow) {
                try {
                    iframe.contentWindow.postMessage(message, 'http://localhost:3001');
                    console.log('iframe에 메시지 전송:', message);
                } catch (error) {
                    console.error('iframe 메시지 전송 실패:', error);
                    // 에러 발생시 재시도
                    setTimeout(() => sendMessageToIframe(message, retryCount + 1), 200);
                }
            } else {
                console.warn('iframe을 찾을 수 없습니다. 재시도 중...', retryCount + 1);
                // iframe이 없다면 재시도
                setTimeout(() => sendMessageToIframe(message, retryCount + 1), 200);
            }
        }

        // 파일 아이콘 결정
        function getFileIcon(filename) {
            if (!filename) return '📄';
            
            const ext = filename.toLowerCase().split('.').pop();
            const iconMap = {
                'pdf': '📕',
                'doc': '📘', 
                'docx': '📘',
                'hwp': '📗',
                'hwpx': '📗',
                'xls': '📊',
                'xlsx': '📊',
                'ppt': '📊',
                'pptx': '📊',
                'zip': '📦',
                'rar': '📦'
            };
            
            return iconMap[ext] || '📄';
        }
        
        // PDF 바로보기 
        function viewPDF(filepath, filename) {
            if (filepath === '#' || !filepath) {
                showToast('PDF 파일을 찾을 수 없습니다', 'error');
                return;
            }
            
            // filepath에서 파라미터 추출 (예: "downFile.do?filenm=file.pdf&uuid=123&saveGbn=dept")
            const params = new URLSearchParams(filepath.split('?')[1] || '');
            const viewUrl = `/viewFile.do?${params.toString()}`;
            
            // PDF 뷰어 모달 생성
            const pdfModal = document.createElement('div');
            pdfModal.className = 'pdf-modal';
            pdfModal.id = 'pdfModal';
            pdfModal.innerHTML = `
                <div class="pdf-modal-content">
                    <div class="pdf-modal-header">
                        <h3>📕 ${filename}</h3>
                        <div>
                            <button class="pdf-btn pdf-download-btn" onclick="downloadFile('${downloadUrl || filepath}', '${filename}')" title="다운로드">
                                📥 다운로드
                            </button>
                            <button class="pdf-close" onclick="closePDFModal()">&times;</button>
                        </div>
                    </div>
                    <div class="pdf-modal-body">
                        <div class="pdf-loading">PDF 파일을 불러오는 중...</div>
                        <iframe src="${viewUrl}" 
                                width="100%" height="100%" frameborder="0" style="display:none;"
                                onload="this.style.display='block'; this.parentNode.querySelector('.pdf-loading').style.display='none'; showToast('PDF 파일이 로드되었습니다', 'success')"
                                onerror="this.parentNode.innerHTML='<div style=text-align:center;padding:50px;color:#d32f2f>PDF 파일을 불러올 수 없습니다.</div>'">
                        </iframe>
                    </div>
                </div>
            `;
            
            // PDF 모달 스타일
            pdfModal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.85);
                z-index: 10000;
                display: flex;
                align-items: center;
                justify-content: center;
                animation: fadeIn 0.3s ease;
            `;
            
            document.body.appendChild(pdfModal);
            document.body.style.overflow = 'hidden'; // 배경 스크롤 방지
            showToast(`${filename} 파일을 여는 중...`, 'info');
        }
        
        // PDF 모달 닫기
        function closePDFModal() {
            const pdfModal = document.querySelector('.pdf-modal');
            if (pdfModal) {
                pdfModal.remove();
                document.body.style.overflow = ''; // 스크롤 복원
            }
        }
        
        // PDF 뷰어 열기 (미리보기 기능)
        function openPDFViewer(downloadUrl, filename) {
            if (!downloadUrl || downloadUrl === '#') {
                showToast('PDF 파일을 찾을 수 없습니다', 'error');
                return;
            }
            
            // PDF 뷰어 모달 생성
            const pdfModal = document.createElement('div');
            pdfModal.className = 'pdf-modal';
            pdfModal.id = 'pdfModal';
            pdfModal.innerHTML = `
                <div class="pdf-modal-content">
                    <div class="pdf-modal-header">
                        <h3>📕 ${filename}</h3>
                        <div>
                            <button class="pdf-btn pdf-download-btn" onclick="downloadFile('${downloadUrl}', '${filename}')" title="다운로드">
                                📥 다운로드
                            </button>
                            <button class="pdf-close" onclick="closePDFModal()">&times;</button>
                        </div>
                    </div>
                    <div class="pdf-modal-body">
                        <div class="pdf-loading">PDF 파일을 불러오는 중...</div>
                        <iframe src="${downloadUrl}" 
                                width="100%" height="100%" frameborder="0" style="display:none;"
                                onload="this.style.display='block'; this.previousElementSibling.style.display='none';"
                                onerror="this.previousElementSibling.innerHTML='PDF 파일을 불러올 수 없습니다. 다운로드하여 확인해주세요.';">
                        </iframe>
                    </div>
                </div>
            `;
            
            document.body.appendChild(pdfModal);
            document.body.style.overflow = 'hidden'; // 배경 스크롤 방지
            showToast(`${filename} PDF를 미리보기로 여는 중...`, 'info');
        }
        
        // 지원하기 함수 - 바로 해당 게시글로 연결
        function applyToJob(jobIdx) {
            const jobUrl = `https://www.gojobs.go.kr/apmView.do?empmnsn=${jobIdx}&selMenuNo=400&menuNo=401&upperMenuNo=`;
            window.open(jobUrl, '_blank');
        }
        
        // 파일 다운로드
        function downloadFile(filepath, filename) {
            if (!filepath || filepath === '#') {
                showToast('다운로드할 파일을 찾을 수 없습니다', 'error');
                return;
            }
            
            try {
                console.log('파일 다운로드 시작:', filename, 'filepath:', filepath);
                
                // 나라일터 실제 다운로드 URL 구조로 변환
                let downloadUrl;
                
                // filepath는 보통 "downFile.do?filenm=파일명&uuid=값&saveGbn=employ" 형태
                if (filepath.startsWith('http')) {
                    // 이미 완전한 URL인 경우
                    downloadUrl = filepath;
                } else if (filepath.startsWith('downFile.do')) {
                    // 나라일터 다운로드 API 경로
                    downloadUrl = `https://www.gojobs.go.kr/apmView.do/${filepath}`;
                } else if (filepath.includes('?')) {
                    // 파라미터가 포함된 경로
                    downloadUrl = `https://www.gojobs.go.kr/apmView.do/downFile.do${filepath}`;
                } else {
                    // 기본 다운로드 경로 구성
                    // filepath가 단순 파일명인 경우 URL 파라미터 구성
                    const params = new URLSearchParams({
                        filenm: filename,
                        uuid: filepath,
                        saveGbn: 'employ'
                    });
                    downloadUrl = `https://www.gojobs.go.kr/apmView.do/downFile.do?${params.toString()}`;
                }
                
                console.log('최종 다운로드 URL:', downloadUrl);
                
                // 파일 확장자 확인
                const fileExt = filename.toLowerCase().split('.').pop();
                
                // 새 창에서 다운로드 (CORS 정책 우회)
                if (fileExt === 'pdf') {
                    // PDF는 새 창에서 열기
                    window.open(downloadUrl, '_blank');
                    showToast(`${filename} PDF 파일을 새 창에서 엽니다`, 'info');
                } else if (['hwp', 'hwpx'].includes(fileExt)) {
                    // HWP 파일 다운로드
                    window.open(downloadUrl, '_blank');
                    showToast(`${filename} HWP 파일 다운로드를 시작합니다`, 'success');
                } else {
                    // 기타 파일 다운로드
                    window.open(downloadUrl, '_blank');
                    showToast(`${filename} 다운로드를 시작합니다`, 'success');
                }
                
                console.log('다운로드 창 열기 완료');
                
            } catch (error) {
                console.error('파일 다운로드 오류:', error);
                showToast('파일 다운로드 중 오류가 발생했습니다. 나라일터 사이트에서 직접 다운로드해주세요.', 'error');
            }
        }
        
        // 이벤트 리스너
        document.addEventListener('DOMContentLoaded', function() {
            // 모달 닫기 이벤트
            document.querySelector('.close').onclick = closeModal;
            
            // 모달 외부 클릭시 닫기
            window.onclick = function(event) {
                const modal = document.getElementById('jobModal');
                if (event.target === modal) {
                    closeModal();
                }
            };
            
            // 검색 이벤트
            const searchInput = document.getElementById('searchInput');
            searchInput.addEventListener('input', searchJobs);
            searchInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    searchJobs();
                }
            });
            
            // 초기 로드
            loadJobs();
        });

        // 공공기관 통계 로드 함수
        async function loadPublicStats() {
            try {
                console.log('공공기관 통계 로드 시작');
                
                // 채용공고 데이터만 가져와서 직접 통계 계산
                const jobsResponse = await fetch('http://localhost:3001/api/jobs?limit=300');
                
                if (jobsResponse.ok) {
                    const jobsData = await jobsResponse.json();
                    const publicJobs = jobsData.jobs || [];
                    
                    console.log('공공기관 채용공고 데이터 로드 완료:', publicJobs.length, '건');
                    
                    // allJobs와 filteredJobs를 공공기관 데이터로 업데이트
                    allJobs = publicJobs;
                    filteredJobs = [...allJobs];
                    
                    // 통계를 실제 데이터로 계산하여 업데이트
                    updateAllStats(publicJobs, 'total', publicJobs.length);
                    
                } else {
                    console.error('공공기관 채용공고 로드 실패:', jobsResponse.status);
                    // 실패시 빈 데이터로 초기화
                    allJobs = [];
                    filteredJobs = [];
                    updateAllStats([], 'total', 0);
                }
            } catch (error) {
                console.error('공공기관 데이터 API 호출 실패:', error);
                // 오류시 빈 데이터로 초기화
                allJobs = [];
                filteredJobs = [];
                updateAllStats([], 'total', 0);
            }
        }

        // 정부기관 통계 로드 함수
        async function loadGovernmentStats() {
            try {
                // 정부기관 데이터 로드 (기본 allJobs 데이터 사용)
                await loadJobs();
                
                // 실제 로드된 데이터 기반으로 통계 계산
                const governmentStats = calculateStatsFromJobs(allJobs);
                console.log('📊 실제 데이터 기반 통계:', governmentStats);
                updateStatsDisplay(governmentStats);
                
            } catch (error) {
                console.error('정부기관 데이터 로드 실패:', error);
                // 기본값으로 fallback (빈 데이터 기준)
                const governmentStats = {
                    total_count: 0,
                    urgent_count: 0,
                    new_count: 0,
                    org_count: 0
                };
                updateStatsDisplay(governmentStats);
            }
        }

        // 실제 데이터 기반 통계 계산 함수
        function calculateStatsFromJobs(jobs) {
            if (!jobs || jobs.length === 0) {
                return {
                    total_count: 0,
                    urgent_count: 0,
                    new_count: 0,
                    org_count: 0
                };
            }

            // 대한민국 서울 시간대 기준으로 오늘 날짜 설정 (9월 12일)
            const koreaTime = new Date();
            koreaTime.setHours(koreaTime.getHours() + 9); // UTC+9 (한국 시간)
            const today = new Date('2024-09-12'); // 오늘 날짜를 9월 12일로 설정
            const sevenDaysAgo = new Date();
            sevenDaysAgo.setDate(today.getDate() - 7);
            
            const orgSet = new Set();
            let urgentCount = 0;
            let newCount = 0;

            jobs.forEach(job => {
                // 기관명 수집 (중복 제거용)
                if (job.dept_name) {
                    orgSet.add(job.dept_name);
                }

                // 긴급 채용 판단 (마감일이 7일 이내)
                if (job.end_date && job.end_date !== '99991231') {
                    const endDate = parseDate(job.end_date);
                    if (endDate && endDate <= sevenDaysAgo) {
                        urgentCount++;
                    }
                }

                // 최신 채용공고 판단 (등록일이 7일 이내)
                if (job.reg_date) {
                    const regDate = parseDate(job.reg_date);
                    if (regDate && regDate >= sevenDaysAgo) {
                        newCount++;
                    }
                }
            });

            return {
                total_count: jobs.length,
                urgent_count: urgentCount,
                new_count: newCount,
                org_count: orgSet.size
            };
        }

        // 날짜 파싱 함수 (YYYYMMDD -> Date)
        function parseDate(dateString) {
            if (!dateString || dateString.length !== 8) return null;
            
            const year = parseInt(dateString.substring(0, 4));
            const month = parseInt(dateString.substring(4, 6)) - 1; // month는 0부터 시작
            const day = parseInt(dateString.substring(6, 8));
            
            return new Date(year, month, day);
        }

        // 통계 화면 업데이트 함수
        function updateStatsDisplay(stats) {
            document.getElementById('totalJobs').textContent = stats.total_count || 0;
            document.getElementById('urgentJobs').textContent = stats.urgent_count || 0;
            document.getElementById('recentJobs').textContent = stats.new_count || 0;
            document.getElementById('totalDepts').textContent = stats.org_count || 0;
        }

        // iframe에서 데이터 업데이트 수신 이벤트 리스너
        window.addEventListener('message', function(event) {
            // 보안을 위해 origin 확인 (포트 8002 추가)
            if (event.origin !== 'http://localhost:3001' && event.origin !== 'http://localhost:8002') return;
            
            const { action, data } = event.data;
            
            switch (action) {
                case 'updateStats':
                    // 자식에서 전송한 데이터로 통계 자동 업데이트
                    console.log('📊 자식 페이지에서 통계 데이터 수신:', data);
                    updateStatsFromChildData(data);
                    break;
                    
                case 'dataLoaded':
                    // 자식 페이지에서 새로운 데이터가 로드되었을 때
                    console.log('🔄 자식 페이지에서 새 데이터 로드 완료:', data.length, '건');
                    calculateAndUpdateStats(data);
                    break;
                    
                case 'filterResult':
                    // 필터링 결과 수신
                    console.log('🔍 자식 페이지 필터링 결과:', data.length, '건');
                    break;
            }
        });

        // 자식 데이터를 기반으로 통계 자동 계산
        function calculateAndUpdateStats(jobsData) {
            if (!Array.isArray(jobsData)) return;
            
            // 대한민국 서울 시간대 기준 (9월 12일)
            const now = new Date('2024-09-12');
            const threeDaysLater = new Date(now.getTime() + (3 * 24 * 60 * 60 * 1000));
            const sevenDaysAgo = new Date(now.getTime() - (7 * 24 * 60 * 60 * 1000));
            
            let totalCount = jobsData.length;
            let urgentCount = 0;
            let newCount = 0;
            let orgSet = new Set();
            
            jobsData.forEach(job => {
                // 임박 (마감일 3일 이내)
                if (job.close_date) {
                    const closeDate = new Date(job.close_date);
                    if (closeDate <= threeDaysLater && closeDate >= now) {
                        urgentCount++;
                    }
                }
                
                // 최근 채용 (등록일 7일 이내)
                if (job.reg_date) {
                    const regDate = new Date(job.reg_date);
                    if (regDate >= sevenDaysAgo) {
                        newCount++;
                    }
                }
                
                // 등록기관 (중복 제거)
                if (job.dept_name) {
                    orgSet.add(job.dept_name);
                }
            });
            
            const calculatedStats = {
                total_count: totalCount,
                urgent_count: urgentCount,
                new_count: newCount,
                org_count: orgSet.size
            };
            
            console.log('📈 자동 계산된 통계:', calculatedStats);
            updateStatsDisplay(calculatedStats);
            
            // 현재 통계 데이터를 전역 변수에 저장 (클릭 필터링용)
            window.currentStats = calculatedStats;
            window.currentJobsData = jobsData;
        }

        // 자식에서 직접 전송한 통계 데이터로 업데이트
        function updateStatsFromChildData(stats) {
            updateStatsDisplay(stats);
            window.currentStats = stats;
        }

        // iframe 로드 완료 시 자식에게 데이터 요청
        function requestChildData() {
            const iframe = document.getElementById('embedJobCards');
            if (iframe && iframe.contentWindow) {
                console.log('🔄 iframe 로드 완료, 자식에게 데이터 요청');
                setTimeout(() => {
                    iframe.contentWindow.postMessage({
                        action: 'requestData'
                    }, 'http://localhost:8002');
                }, 1000); // iframe 완전 로드를 위한 딜레이
            }
        }

        // 연결 예정 메시지 표시 (작은 크기, 0.2초 표시)
        function showConnectingSoonMessage(type) {
            // 기존 메시지가 있으면 제거
            const existingMessage = document.querySelector('.connecting-soon-message');
            if (existingMessage) {
                existingMessage.remove();
            }
            
            // 메시지 엘리먼트 생성
            const message = document.createElement('div');
            message.className = 'connecting-soon-message';
            message.textContent = `${type} 연결 예정`;
            
            // 페이지에 추가
            document.body.appendChild(message);
            
            // 애니메이션 시작
            setTimeout(() => {
                message.classList.add('show');
            }, 10);
            
            // 0.2초 후 페이드아웃 및 제거
            setTimeout(() => {
                message.classList.remove('show');
                setTimeout(() => {
                    if (message.parentNode) {
                        message.parentNode.removeChild(message);
                    }
                }, 200);
            }, 200);
        }

        // 페이지 로드시 기본 통계 로드
        window.addEventListener('DOMContentLoaded', function() {
            // 기본적으로 정부기관이 체크되어 있으므로 정부기관 통계 로드
            const governmentCheckbox = document.getElementById('filter-government');
            if (governmentCheckbox && governmentCheckbox.checked) {
                loadGovernmentStats();
            }
        });
    </script>

</body>
</html>
